<html>
<head>
    <!-- 2016 Gordon Williams, gw@pur3.co.uk

    Any copyright is dedicated to the Public Domain.
    http://creativecommons.org/publicdomain/zero/1.0/

    -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=320, initial-scale=1">
    <title>Online Heart Rate Monitor</title>
</head>
<body>
<p>Allow this website to use your webcam, then place your finger lightly over the camera and wait for the trace to
    stabilise.</p>
<p>You will have most success when there is light behind your finger.</p>
<video id="v" width="100" height="100" style="display:none" muted></video>
<canvas id="c" width="100" height="100" style="display:none"></canvas>
<canvas id="g" width="320" height="30"></canvas>
<br/>
<div id="bpm">--</div>
<p><a href="https://github.com/gfwilliams/HeartRate">GitHub</a></p>
<p>Also, check out <a href="http://www.puck-js.com/">Puck.js</a></p>
<button class="switch">On / Off</button>
<script>
    //Test browser support
    const SUPPORTS_MEDIA_DEVICES = 'mediaDevices' in navigator;

    if (SUPPORTS_MEDIA_DEVICES) {
        //Get the environment camera (usually the second one)
        navigator.mediaDevices.enumerateDevices().then(devices => {

            const cameras = devices.filter((device) => device.kind === 'videoinput');

            if (cameras.length === 0) {
                throw 'No camera found on this device.';
            }
            const camera = cameras[cameras.length - 1];

            // Create stream and get video track
            navigator.mediaDevices.getUserMedia({
                video: {
                    deviceId: camera.deviceId,
                    facingMode: ['user', 'environment'],
                    height: {ideal: 1080},
                    width: {ideal: 1920}
                }
            }).then(stream => {
                const track = stream.getVideoTracks()[0];
                track.applyConstraints({
                    advanced: [{torch: true}]
                });
            });
        });
        function onCapabilitiesReady(capabilities) {
            alert(track.getSettings());
        }
        //The light will be on as long the track exists


    }
</script>
</body>
</html>
